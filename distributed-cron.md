# Distributed cron
I needed to poll multiple blockchains for the top (ranked by another bespoke process) 400 token prices and push that data into Firestore.  Up to this point, the startup I was working for had used an Azure cloud function that ran every minute to collect prices of just 3 tokens on one blockchain.  The problem was that for 400 tokens this was taking 15 minutes.  We could only increase the running time of the cloud function to 10 minutes maximum without incurring higher costs or having to run multiple cloud functions, which would incur higher costs.

The solution I devised was to process a subset of the tokens each time the cron triggered instead of the full set.  I did this by determining which 5 minute 'bucket' of time for the hour starting at minute 0, minute 5, minute 10, etc. that we were in when the cron triggered  Then used modulus to determine if the starting minute of that bucket was a multiple of 3 with a remainder of 0, 1, or 2.  If the remainder was 0 we'd process the first third of the tokens only when it ran that time.  If the remainder was 1 we'd process the second third of the tokens, and the final third of the tokens when the remainder was 2.  This way a process that took 15 minutes could be handled on a 5 minute cron by a function that could run for up to 10 minutes.  This way the full set of tokens was always processed aprox every 15 minutes.  There would be some exceptions but they would be negligible.
